{% extends 'base.html' %}
{% block title %}Take Quiz{% endblock %}

{% block content %}
<div class="container mt-4">
    <h3>{{ quiz.title }}</h3>
    <form method="post">
        {% csrf_token %}
        {% for question in questions %}
            <div class="mb-4">
                <strong>{{ forloop.counter }}. {{ question.text }}</strong>
                {% for choice in question.choices.all %}
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="q_{{ question.id }}" value="{{ choice.id }}" required>
                        <label class="form-check-label">{{ choice.text }}</label>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
        <button type="submit" class="btn btn-primary">Submit Quiz</button>
    </form>
</div>
{% endblock %}


{% block script %}
<script>
  let time = {{ quiz.duration|default:10|floatformat:0 }} * 60; // fallback 10 minutes if missing
  const timerElement = document.getElementById('timer');
  const form = document.getElementById('quiz-form');

  const updateTimer = () => {
    const minutes = Math.floor(time / 60);
    const seconds = time % 60;
    timerElement.innerText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    if (time <= 0) {
      clearInterval(timerInterval);
      form.submit();
    }
    time--;
  };

  const timerInterval = setInterval(updateTimer, 1000);
  updateTimer(); // run once immediately
</script>
{% endblock %}

